<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>3D Quick Sort Visualization</title>

    <style>
      body {
        margin: 0;
        overflow: hidden;
        background: radial-gradient(circle at top, #1a1a1a, #000);
        font-family: "Segoe UI", sans-serif;
      }

      /* BACK BUTTON */
      .back-btn {
        position: fixed;
        top: 18px;
        left: 18px;
        font-size: 32px;
        color: #00eaff;
        text-decoration: none;
        font-weight: bold;
        z-index: 100;
      }

      /* HEADER */
      header {
        position: fixed;
        top: 0;
        width: 100%;
        height: 90px;
        background: rgba(0, 0, 0, 0.75);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        z-index: 50;
      }
      header .title {
        font-size: 28px;
        color: #00eaff;
      }
      header .subtitle {
        font-size: 14px;
        color: #b5f7ff;
      }

      /* PANEL */
      #panel {
        position: fixed;
        top: 120px;
        left: 20px;
        width: 270px;
        background: rgba(255, 255, 255, 0.08);
        backdrop-filter: blur(10px);
        border-radius: 14px;
        padding: 16px;
        color: #fff;
        z-index: 40;
      }

      input,
      button {
        width: 100%;
        margin-top: 8px;
        padding: 8px;
        border-radius: 8px;
        border: none;
      }
      input {
        background: rgba(0, 0, 0, 0.6);
        color: #00eaff;
      }
      button {
        background: linear-gradient(135deg, #00eaff, #0077ff);
        font-weight: bold;
        cursor: pointer;
      }

      #status {
        margin-top: 12px;
        padding: 8px;
        text-align: center;
        background: rgba(0, 0, 0, 0.5);
        color: #00eaff;
      }

      /* CODE PANEL */
      #code {
        margin-top: 14px;
        background: white;
        color: black;
        border-radius: 10px;
        padding: 10px;
        font-family: Consolas, monospace;
      }
      #code div {
        padding: 4px 6px;
      }
      .active {
        background: #cceeff;
        font-weight: bold;
      }
    </style>
  </head>

  <body>
    <a href="index.html" class="back-btn">‚Üê</a>

    <header>
      <div class="title">Quick Sort</div>
      <div class="subtitle">3D Visualization with Code Execution</div>
    </header>

    <div id="panel">
      <input id="arrayInput" value="5,3,8,4,2,7" />
      <button onclick="generate()">Generate</button>
      <button onclick="start()">‚ñ∂ Start</button>
      <button onclick="pause()">‚è∏ Pause</button>
      <button onclick="reset()">üîÑ Reset</button>

      <label>Speed</label>
      <input id="speed" type="range" min="1" max="100" value="50" />

      <div id="status">Status: Ready</div>

      <div id="code">
        <div id="l1">quickSort(low, high)</div>
        <div id="l2">&nbsp;&nbsp;if (low &lt; high)</div>
        <div id="l3">&nbsp;&nbsp;&nbsp;&nbsp;p = partition()</div>
        <div id="l4">&nbsp;&nbsp;&nbsp;&nbsp;quickSort(low, p-1)</div>
        <div id="l5">&nbsp;&nbsp;&nbsp;&nbsp;quickSort(p+1, high)</div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>

    <script>
      /* ---------- THREE ---------- */
      const scene = new THREE.Scene();
      scene.background = new THREE.Color(0x111111);

      const camera = new THREE.PerspectiveCamera(
        60,
        window.innerWidth / window.innerHeight,
        0.1,
        1000,
      );
      camera.position.set(0, 10, 18);
      camera.lookAt(0, 5, 0);

      const renderer = new THREE.WebGLRenderer({ antialias: true });
      renderer.setSize(window.innerWidth, window.innerHeight);
      renderer.domElement.style.position = "fixed";
      renderer.domElement.style.zIndex = "1";
      document.body.appendChild(renderer.domElement);

      scene.add(new THREE.AmbientLight(0xffffff, 0.7));
      scene.add(new THREE.DirectionalLight(0xffffff, 1));

      const group = new THREE.Group();
      scene.add(group);

      /* ---------- DATA ---------- */
      let array = [],
        bars = [],
        labels = [];
      let steps = [],
        stepIndex = 0;
      let running = false,
        lastTime = 0;

      /* ---------- LABEL ---------- */
      function label(text) {
        const c = document.createElement("canvas");
        c.width = 256;
        c.height = 128;
        const ctx = c.getContext("2d");
        ctx.fillStyle = "#fff";
        ctx.font = "bold 64px Arial";
        ctx.textAlign = "center";
        ctx.textBaseline = "middle";
        ctx.fillText(text, 128, 64);
        const t = new THREE.CanvasTexture(c);
        const s = new THREE.Sprite(new THREE.SpriteMaterial({ map: t }));
        s.scale.set(2.2, 1.1, 1);
        return s;
      }

      /* ---------- BOXES ---------- */
      function createBars() {
        group.clear();
        bars = [];
        labels = [];
        const spacing = 1.6;
        const max = Math.max(...array);
        array.forEach((v, i) => {
          const h = (v / max) * 8 + 0.5;
          const bar = new THREE.Mesh(
            new THREE.BoxGeometry(1, h, 1),
            new THREE.MeshStandardMaterial({ color: 0x0077ff }),
          );
          bar.position.set(
            i * spacing - ((array.length - 1) * spacing) / 2,
            h / 2,
            0,
          );
          const lb = label(v);
          lb.position.set(bar.position.x, -1.2, 0);
          bar.userData.label = lb;
          group.add(bar, lb);
          bars.push(bar);
          labels.push(lb);
        });
      }

      /* ---------- CODE HIGHLIGHT ---------- */
      function hl(id) {
        ["l1", "l2", "l3", "l4", "l5"].forEach((x) => {
          document.getElementById(x).classList.remove("active");
        });
        if (id) document.getElementById(id).classList.add("active");
      }

      /* ---------- QUICK SORT STEPS ---------- */
      function buildSteps(arr, l, h) {
        if (l >= h) return;
        hl("l2");
        let pivot = arr[h],
          i = l;
        for (let j = l; j < h; j++) {
          steps.push({ t: "compare", i: j, p: h });
          if (arr[j] < pivot) {
            [arr[i], arr[j]] = [arr[j], arr[i]];
            steps.push({ t: "swap", a: i, b: j });
            i++;
          }
        }
        [arr[i], arr[h]] = [arr[h], arr[i]];
        steps.push({ t: "swap", a: i, b: h });
        steps.push({ t: "pivot", i });
        buildSteps(arr, l, i - 1);
        buildSteps(arr, i + 1, h);
      }

      /* ---------- STEP APPLY ---------- */
      function applyStep() {
        bars.forEach((b) => b.material.color.set(0x0077ff));
        const s = steps[stepIndex++];
        if (!s) {
          bars.forEach((b) => b.material.color.set(0x00ff00));
          document.getElementById("status").innerText = "Sorting Completed";
          running = false;
          return;
        }
        document.getElementById("status").innerText = "Sorting...";
        if (s.t === "compare") {
          hl("l3");
          bars[s.i].material.color.set(0xffff00);
          bars[s.p].material.color.set(0xff00ff);
        }
        if (s.t === "swap") {
          hl("l3");
          const a = bars[s.a],
            b = bars[s.b];
          [bars[s.a], bars[s.b]] = [bars[s.b], bars[s.a]];
          let x = a.position.x;
          a.position.x = b.position.x;
          b.position.x = x;
          let la = a.userData.label,
            lb = b.userData.label;
          let lx = la.position.x;
          la.position.x = lb.position.x;
          lb.position.x = lx;
        }
      }

      /* ---------- CONTROLS ---------- */
      function generate() {
        running = false;
        stepIndex = 0;
        steps = [];
        array = document
          .getElementById("arrayInput")
          .value.split(",")
          .map(Number);
        createBars();
        buildSteps([...array], 0, array.length - 1);
        hl("l1");
        document.getElementById("status").innerText = "Status: Ready";
      }
      function start() {
        running = true;
      }
      function pause() {
        running = false;
      }
      function reset() {
        generate();
      }

      /* ---------- LOOP ---------- */
      function animate(t) {
        requestAnimationFrame(animate);
        if (running) {
          const delay = 2100 - document.getElementById("speed").value * 20;
          if (t - lastTime > delay) {
            applyStep();
            lastTime = t;
          }
        }
        labels.forEach((l) => l.lookAt(camera.position));
        renderer.render(scene, camera);
      }
      animate();

      window.addEventListener("resize", () => {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
      });

      generate();
    </script>
  </body>
</html>
