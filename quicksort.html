<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>3D Quick Sort (Bars with Values)</title>

  <style>
    body {
      margin: 0;
      overflow: hidden;
      background: radial-gradient(circle at top, #1a1a1a, #000);
      font-family: "Segoe UI", sans-serif;
    }

    header {
      position: absolute;
      top: 0;
      width: 100%;
      text-align: center;
      padding: 14px;
      font-size: 26px;
      font-weight: 700;
      letter-spacing: 2px;
      color: #00eaff;
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(6px);
      z-index: 20;
    }

    #panel {
      position: absolute;
      top: 80px;
      left: 20px;
      width: 270px;
      background: rgba(255, 255, 255, 0.08);
      backdrop-filter: blur(10px);
      border-radius: 14px;
      padding: 16px;
      color: #fff;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.6);
      z-index: 10;
    }

    input, button {
      width: 100%;
      margin-top: 8px;
      padding: 8px;
      border-radius: 8px;
      border: none;
      font-size: 14px;
    }

    input {
      background: rgba(0, 0, 0, 0.6);
      color: #00eaff;
    }

    button {
      cursor: pointer;
      font-weight: bold;
      background: linear-gradient(135deg, #00eaff, #0077ff);
      color: #000;
    }

    #status {
      margin-top: 12px;
      padding: 8px;
      text-align: center;
      border-radius: 8px;
      font-weight: bold;
      background: rgba(0, 0, 0, 0.5);
      color: #00eaff;
    }
  </style>
</head>

<body>
<header>QUICK SORT (BAR VISUALIZATION)</header>

<div id="panel">
  <input id="arrayInput" value="5,3,8,4,2,7" />
  <button onclick="generate()">Generate</button>
  <button onclick="startQuickSort()">‚ñ∂ Start Quick Sort</button>
  <button onclick="pauseSort()">‚è∏ Pause</button>
  <button onclick="resetSort()">üîÑ Reset</button>

  <input id="speed" type="range" min="300" max="2000" value="800" />
  <div id="status">Status: Ready</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>

<script>
/* ---------- SCENE ---------- */
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x111111);

const camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
camera.position.set(0, 10, 18);
camera.lookAt(0, 5, 0);

const renderer = new THREE.WebGLRenderer({ antialias: true });
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

scene.add(new THREE.AmbientLight(0xffffff, 0.7));
scene.add(new THREE.DirectionalLight(0xffffff, 1));

/* ---------- VARIABLES ---------- */
let array = [];
let bars = [];
let steps = [];
let timer = null;

const group = new THREE.Group();
scene.add(group);

/* ---------- STATUS ---------- */
function updateStatus(msg, color = "#00eaff") {
  const s = document.getElementById("status");
  s.innerText = msg;
  s.style.color = color;
}

/* ---------- TEXT LABEL ---------- */
function createTextSprite(text) {
  const canvas = document.createElement("canvas");
  canvas.width = 256;
  canvas.height = 128;
  const ctx = canvas.getContext("2d");

  ctx.font = "bold 64px Arial";
  ctx.fillStyle = "#ffffff";
  ctx.textAlign = "center";
  ctx.textBaseline = "middle";
  ctx.fillText(text, canvas.width / 2, canvas.height / 2);

  const texture = new THREE.CanvasTexture(canvas);
  const sprite = new THREE.Sprite(new THREE.SpriteMaterial({ map: texture }));
  sprite.scale.set(2.4, 1.2, 1);
  return sprite;
}

/* ---------- CREATE BARS ---------- */
function createBars() {
  group.clear();
  bars = [];

  const spacing = 1.5;
  const maxVal = Math.max(...array);

  array.forEach((val, i) => {
    const h = (val / maxVal) * 8 + 0.5;

    const bar = new THREE.Mesh(
      new THREE.BoxGeometry(1, h, 1),
      new THREE.MeshStandardMaterial({ color: 0x0077ff })
    );

    bar.position.set(i * spacing - ((array.length - 1) * spacing) / 2, h / 2, 0);

    const label = createTextSprite(val.toString());
    label.position.set(bar.position.x, -1.1, 0);

    bar.userData.label = label;

    group.add(bar);
    group.add(label);
    bars.push(bar);
  });
}

/* ---------- GENERATE ---------- */
window.generate = function () {
  pauseSort();

  array = document.getElementById("arrayInput").value
    .split(",").map(x => Number(x.trim())).filter(x => !isNaN(x));

  if (!array.length) return alert("Enter valid numbers");

  steps = [];
  const temp = [...array];
  quickSortSteps(temp, 0, temp.length - 1);

  createBars();
  updateStatus("Status: Ready");
};

/* ---------- SWAP ---------- */
function swap(a, b) {
  [array[a], array[b]] = [array[b], array[a]];
  [bars[a], bars[b]] = [bars[b], bars[a]];

  let x = bars[a].position.x;
  bars[a].position.x = bars[b].position.x;
  bars[b].position.x = x;

  let la = bars[a].userData.label;
  let lb = bars[b].userData.label;
  let lx = la.position.x;
  la.position.x = lb.position.x;
  lb.position.x = lx;
}

/* ---------- QUICK SORT STEPS ---------- */
function quickSortSteps(arr, low, high) {
  if (low >= high) return;

  let pivot = arr[high];
  let i = low;

  steps.push({ type: "pivot", index: high });

  for (let j = low; j < high; j++) {
    steps.push({ type: "compare", indices: [j, high] });

    if (arr[j] < pivot) {
      steps.push({ type: "swap", indices: [i, j] });
      [arr[i], arr[j]] = [arr[j], arr[i]];
      i++;
    }
  }

  steps.push({ type: "swap", indices: [i, high] });
  [arr[i], arr[high]] = [arr[high], arr[i]];

  quickSortSteps(arr, low, i - 1);
  quickSortSteps(arr, i + 1, high);
}

/* ---------- APPLY STEP ---------- */
function applyStep() {
  if (!steps.length) {
    bars.forEach(b => b.material.color.set(0x00ff00));
    updateStatus("Sorting Completed", "#00ff00");
    pauseSort();
    return;
  }

  updateStatus("Sorting...", "#ffff00");
  bars.forEach(b => b.material.color.set(0x0077ff));

  const step = steps.shift();

  if (step.type === "pivot")
    bars[step.index].material.color.set(0xff00ff);

  if (step.type === "compare")
    step.indices.forEach(i => bars[i].material.color.set(0xffff00));

  if (step.type === "swap")
    swap(step.indices[0], step.indices[1]);
}

/* ---------- CONTROLS ---------- */
window.startQuickSort = () => {
  if (timer) return;
  timer = setInterval(applyStep, document.getElementById("speed").value);
};

window.pauseSort = () => {
  clearInterval(timer);
  timer = null;
};

window.resetSort = () => {
  pauseSort();
  createBars();
  updateStatus("Status: Ready");
};

/* ---------- ANIMATION ---------- */
function animate() {
  requestAnimationFrame(animate);
  renderer.render(scene, camera);
}
animate();

window.addEventListener("resize", () => {
  camera.aspect = window.innerWidth / window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth, window.innerHeight);
});

generate();
</script>
</body>
</html>
