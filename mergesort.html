<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Merge Sort ‚Äì Divide & Conquer Tree</title>

<style>
body{
  margin:0;
  background:radial-gradient(circle at top,#1a1a1a,#000);
  font-family:"Segoe UI",sans-serif;
  overflow:hidden;
}
header{
  position:absolute;
  top:0;
  width:100%;
  text-align:center;
  padding:14px;
  font-size:26px;
  font-weight:700;
  color:#00eaff;
  background:rgba(0,0,0,0.5);
}
#panel{
  position:absolute;
  top:80px;
  left:20px;
  width:260px;
  background:rgba(255,255,255,0.08);
  backdrop-filter:blur(10px);
  border-radius:14px;
  padding:16px;
  color:#fff;
}
input,button{
  width:100%;
  margin-top:8px;
  padding:8px;
  border-radius:8px;
  border:none;
}
input{background:rgba(0,0,0,0.6);color:#00eaff;}
button{
  background:linear-gradient(135deg,#00eaff,#0077ff);
  font-weight:bold;
  cursor:pointer;
}
#status{
  margin-top:12px;
  text-align:center;
  color:#00eaff;
}
canvas{display:block;}
</style>
</head>

<body>
<header>MERGE SORT ‚Äì DIVIDE ‚Üí MERGE (TREE VIEW)</header>

<div id="panel">
  <input id="arrayInput" value="38,27,43,3,9,82,10">

  <button onclick="start()">‚ñ∂ Start</button>
  <button onclick="togglePause()">‚è∏ Pause / Resume</button>
  <button onclick="reset()">üîÑ Reset</button>

  <label>Speed</label>
  <input id="speed" type="range" min="200" max="1500" value="700">

  <div id="status">Ready</div>
</div>

<canvas id="canvas"></canvas>

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

function resize(){
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
resize();
window.addEventListener("resize",resize);

/* ---------- DRAW HELPERS ---------- */
function drawBox(x,y,text,color){
  ctx.fillStyle=color;
  ctx.strokeStyle="#fff";
  ctx.lineWidth=1.5;
  ctx.fillRect(x-26,y-18,52,36);
  ctx.strokeRect(x-26,y-18,52,36);
  ctx.fillStyle="#fff";
  ctx.font="bold 18px Arial";
  ctx.textAlign="center";
  ctx.textBaseline="middle";
  ctx.fillText(text,x,y);
}
function drawLine(x1,y1,x2,y2){
  ctx.strokeStyle="#aaa";
  ctx.beginPath();
  ctx.moveTo(x1,y1);
  ctx.lineTo(x2,y2);
  ctx.stroke();
}

/* ---------- STATE ---------- */
let steps = [];
let stepIndex = 0;
let timer = null;
let paused = false;

/* ---------- MERGE SORT STEP GENERATOR ---------- */
function mergeSort(arr,x,y,level,parent){
  const node = { arr:[...arr], x,y,parent, level, type:"split" };
  steps.push(node);

  if(arr.length <= 1) return arr;

  const mid = Math.floor(arr.length / 2);
  const gap = 220 / (level + 1);

  const left  = mergeSort(arr.slice(0,mid), x-gap, y+90, level+1, node);
  const right = mergeSort(arr.slice(mid), x+gap, y+90, level+1, node);

  const merged=[];
  let i=0,j=0;
  while(i<left.length && j<right.length){
    merged.push(left[i] <= right[j] ? left[i++] : right[j++]);
  }
  while(i<left.length) merged.push(left[i++]);
  while(j<right.length) merged.push(right[j++]);

  steps.push({
    arr: merged,
    x,y,
    parent,
    level,
    type:"merge"
  });

  return merged;
}

/* ---------- RENDER STEP ---------- */
function renderStep(){
  if(paused) return;

  if(stepIndex >= steps.length){
    document.getElementById("status").innerText = "Sorting Complete";
    clearInterval(timer);
    timer = null;
    return;
  }

  const n = steps[stepIndex++];

  if(n.parent){
    drawLine(n.parent.x,n.parent.y+20,n.x,n.y-20);
  }

  const spacing = 65;
  const startX = n.x - ((n.arr.length-1) * spacing) / 2;
  const color = n.type === "merge" ? "#00ff88" : "#0077ff";

  n.arr.forEach((v,i)=>{
    drawBox(startX + i*spacing, n.y, v, color);
  });
}

/* ---------- CONTROLS ---------- */
function start(){
  reset();
  const arr = document.getElementById("arrayInput").value
    .split(",").map(Number).filter(n=>!isNaN(n));
  if(!arr.length) return alert("Invalid input");

  document.getElementById("status").innerText = "Sorting...";
  mergeSort(arr, canvas.width/2, 120, 0, null);

  const speed = document.getElementById("speed").value;
  timer = setInterval(renderStep, speed);
}

function togglePause(){
  if(!timer) return;
  paused = !paused;
  document.getElementById("status").innerText =
    paused ? "Paused" : "Sorting...";
}

function reset(){
  clearInterval(timer);
  timer = null;
  paused = false;
  ctx.clearRect(0,0,canvas.width,canvas.height);
  steps = [];
  stepIndex = 0;
  document.getElementById("status").innerText = "Ready";
}
</script>
</body>
</html>
