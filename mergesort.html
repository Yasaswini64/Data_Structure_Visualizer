<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Merge Sort ‚Äì Divide & Conquer Tree</title>

<style>
body{
  margin:0;
  background:radial-gradient(circle at top,#1a1a1a,#000);
  font-family:"Segoe UI",sans-serif;
  overflow:hidden;
}

.back-btn{
  position:fixed;
  top:16px;
  left:16px;
  font-size:32px;
  color:#00eaff;
  text-decoration:none;
  font-weight:700;
  z-index:200;
}

header{
  position:absolute;
  top:0;
  width:100%;
  text-align:center;
  padding:14px;
  font-size:26px;
  font-weight:700;
  color:#00eaff;
  background:rgba(0,0,0,0.5);
}

#panel{
  position:absolute;
  top:80px;
  left:20px;
  width:260px;
  background:rgba(255,255,255,0.08);
  backdrop-filter:blur(10px);
  border-radius:14px;
  padding:16px;
  color:#fff;
}

input,button{
  width:100%;
  margin-top:8px;
  padding:8px;
  border-radius:8px;
  border:none;
}

input{background:rgba(0,0,0,0.6);color:#00eaff;}
button{
  background:linear-gradient(135deg,#00eaff,#0077ff);
  font-weight:bold;
  cursor:pointer;
}

#status{
  margin-top:12px;
  text-align:center;
  color:#00eaff;
}

#code{
  margin-top:14px;
  background:#fff;
  color:#000;
  border-radius:10px;
  padding:10px;
  font-family:Consolas,monospace;
  font-size:13px;
}
#code div{
  padding:4px 6px;
  border-radius:6px;
}
.active{background:#cceeff;font-weight:bold;}

canvas{display:block;}
</style>
</head>

<body>

<a href="HomePage.html" class="back-btn">‚Üê</a>
<header>MERGE SORT ‚Äì DIVIDE ‚Üí MERGE (TREE VIEW)</header>

<div id="panel">
  <input id="arrayInput" value="38,27,43,3,9,82,10">
  <button onclick="start()">‚ñ∂ Start</button>
  <button onclick="togglePause()">‚è∏ Pause</button>
  <button onclick="reset()">üîÑ Reset</button>
  <input id="speed" type="range" min="300" max="1600" value="800">
  <div id="status">Ready</div>

  <div id="code">
    <div id="p1">mergeSort(arr)</div>
    <div id="p2">if size ‚â§ 1 return</div>
    <div id="p3">split array</div>
    <div id="p4">mergeSort(left)</div>
    <div id="p5">mergeSort(right)</div>
    <div id="p6">merge(left, right)</div>
  </div>
</div>

<canvas id="canvas"></canvas>

<script>
const canvas=document.getElementById("canvas");
const ctx=canvas.getContext("2d");
function resize(){canvas.width=innerWidth;canvas.height=innerHeight;}
resize(); addEventListener("resize",resize);

/* DRAW HELPERS */
function box(x,y,t,c){
  ctx.fillStyle=c;
  ctx.strokeStyle="#fff";
  ctx.lineWidth=1.5;
  ctx.fillRect(x-26,y-18,52,36);
  ctx.strokeRect(x-26,y-18,52,36);
  ctx.fillStyle="#fff";
  ctx.font="bold 18px Arial";
  ctx.textAlign="center";
  ctx.textBaseline="middle";
  ctx.fillText(t,x,y);
}
function line(x1,y1,x2,y2){
  ctx.strokeStyle="#aaa";
  ctx.beginPath();
  ctx.moveTo(x1,y1);
  ctx.lineTo(x2,y2);
  ctx.stroke();
}

/* CODE HIGHLIGHT */
function hl(id){
  ["p1","p2","p3","p4","p5","p6"].forEach(x=>{
    document.getElementById(x).classList.remove("active");
  });
  if(id) document.getElementById(id).classList.add("active");
}

/* STEPS */
let steps=[], idx=0, timer=null, paused=false;

/* CORE FIXED MERGE SORT */
function mergeSort(arr,x,y,level){
  steps.push({t:"code",l:"p1"});
  steps.push({t:"draw",arr:[...arr],x,y,c:"#0077ff"});

  if(arr.length<=1){
    steps.push({t:"code",l:"p2"});
    return arr;
  }

  steps.push({t:"code",l:"p3"});
  const mid=Math.floor(arr.length/2);
  const gap=260/(level+1);

  const leftX=x-gap, rightX=x+gap;
  const childY=y+90;

  // üî• VISUAL SPLIT
  steps.push({t:"draw",arr:arr.slice(0,mid),x:leftX,y:childY,c:"#3399ff",px:x,py:y});
  steps.push({t:"draw",arr:arr.slice(mid),x:rightX,y:childY,c:"#3399ff",px:x,py:y});

  steps.push({t:"code",l:"p4"});
  const L=mergeSort(arr.slice(0,mid),leftX,childY,level+1);

  steps.push({t:"code",l:"p5"});
  const R=mergeSort(arr.slice(mid),rightX,childY,level+1);

  steps.push({t:"code",l:"p6"});
  const M=[];
  let i=0,j=0;
  while(i<L.length && j<R.length)
    M.push(L[i]<=R[j]?L[i++]:R[j++]);
  while(i<L.length) M.push(L[i++]);
  while(j<R.length) M.push(R[j++]);

  steps.push({t:"draw",arr:M,x,y,c:"#00ff88"});
  return M;
}

/* RENDER */
function render(){
  if(paused) return;
  if(idx>=steps.length){
    status.innerText="Sorting Complete";
    clearInterval(timer); return;
  }
  const s=steps[idx++];
  if(s.t==="code"){ hl(s.l); return; }
  if(s.px!==undefined) line(s.px,s.py+20,s.x,s.y-20);
  const sp=60, sx=s.x-((s.arr.length-1)*sp)/2;
  s.arr.forEach((v,i)=>box(sx+i*sp,s.y,v,s.c));
}

/* CONTROLS */
function start(){
  reset();
  const arr=arrayInput.value.split(",").map(Number).filter(n=>!isNaN(n));
  if(!arr.length) return;
  status.innerText="Sorting...";
  mergeSort(arr,canvas.width/2,140,0);
  timer=setInterval(render,speed.value);
}
function togglePause(){ paused=!paused; status.innerText=paused?"Paused":"Sorting..."; }
function reset(){
  clearInterval(timer); timer=null; paused=false;
  ctx.clearRect(0,0,canvas.width,canvas.height);
  steps=[]; idx=0; hl(null); status.innerText="Ready";
}
</script>
</body>
</html>
